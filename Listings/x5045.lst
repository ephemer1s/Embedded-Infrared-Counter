C51 COMPILER V9.56.0.0   X5045                                                             09/29/2020 20:14:09 PAGE 1   


C51 COMPILER V9.56.0.0, COMPILATION OF MODULE X5045
OBJECT MODULE PLACED IN .\Objects\x5045.obj
COMPILER INVOKED BY: D:\keil\C51\BIN\C51.EXE x5045.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\x5045.
                    -lst) TABS(2) OBJECT(.\Objects\x5045.obj)

line level    source

   1          #include "x5045.h"
   2          #include "ir.h"
   3          #include <stdio.h>
   4          #include <string.h>
   5          #include <stdlib.h>
   6          
   7          /*延时函数*/
   8          void delay1ms()
   9          {
  10   1        unsigned char i,j; 
  11   1        for(i=0;i<10;i++)
  12   1        for(j=0;j<33;j++);   
  13   1       }
  14          void delaynms(unsigned char n){
  15   1        unsigned char i;
  16   1        for(i=0;i<n;i++)
  17   1        delay1ms();
  18   1      }
  19          
  20          /*写入EEPROM*/
  21          void WriteCurrent(unsigned char dat)
  22          {
  23   1        unsigned char i;
  24   1        SCK=0;                 //停止时钟
  25   1        for(i = 0; i < 8; i++)  //循环8位
  26   1        {
  27   2          SI=(bit)(dat&0x80);   //按位与取最高位
  28   2          SCK=0;
  29   2          SCK=1;             //上升沿锁存
  30   2          dat<<=1;  //左移一位，因为先锁存的是最高位
  31   2        }
  32   1      }
  33          
  34          /*从EEPROM读出数据*/
  35          unsigned char ReadCurrent(void)
  36          {
  37   1         unsigned char i;
  38   1         unsigned char x=0x00;
  39   1         SCK=1;
  40   1         for(i = 0; i < 8; i++)
  41   1         {
  42   2           SCK=1;               //下降沿读出
  43   2           SCK=0;
  44   2           x<<=1;  //左移一位，因为先读出的是最高位
  45   2          x|=(unsigned char)SO;  //按位或运算后幅值给x
  46   2         }
  47   1         return(x);
  48   1       }
  49          
  50          /*写状态寄存器*/
  51          void WriteSR(unsigned char rs)
  52          {
  53   1        CS=0;
  54   1        WriteCurrent(WREN);  //允许写入
C51 COMPILER V9.56.0.0   X5045                                                             09/29/2020 20:14:09 PAGE 2   

  55   1        CS=1;
  56   1        CS=0; //重新拉低使能端
  57   1        WriteCurrent(WRSR);
  58   1        WriteCurrent(rs);   //写入状态寄存器指令
  59   1        CS=1;
  60   1      }
  61          
  62          /*写数据操作*/
  63          void WriteSet(unsigned char dat,unsigned char addr)
  64          {
  65   1        SCK=0;
  66   1        CS=0;
  67   1        WriteCurrent(WREN);
  68   1        CS=1;
  69   1        CS=0;
  70   1        WriteCurrent(WRITE);  //写入存储器
  71   1        WriteCurrent(addr);   //写入指定地址
  72   1        WriteCurrent(dat);    //写入数据
  73   1        CS=1;
  74   1        SCK=0;
  75   1      }
  76          
  77          /*读数据操作*/
  78          unsigned char ReadSet(unsigned char addr)
  79          {
  80   1       unsigned char dat;
  81   1        SCK=0;
  82   1        CS=0;
  83   1        WriteCurrent(READ);
  84   1        WriteCurrent(addr);  //指定数据所在的地址
  85   1        dat=ReadCurrent();
  86   1        CS=1;
  87   1        SCK=0;
  88   1        return dat;
  89   1       }
  90          
  91          /*看门狗复位*/
  92          void WatchDog(void)
  93          {
  94   1        CS=1;
  95   1        CS=0;
  96   1        CS=1;
  97   1      }
  98          
  99          /*定时器初始化*/
 100          void TimeInit(void)
 101          {
 102   1        TMOD = 0x21;    //定时器0为方式1，定时器1为方式2
 103   1        TH0  = TimeTH0; // set interval 10ms
 104   1        TL0  = TimeTL0;
 105   1        TR0  = 1;     // launch timer
 106   1        TH1 = 0xFD; //波特率为9600
 107   1        TL1 = 0xFD;
 108   1        SCON = 0x50; //10位UART，允许接收
 109   1        PCON &= 0xEF;
 110   1        TR1 = 1; //启动定时器
 111   1      }
 112          
 113          /*向串口发送字符*/
 114          void send_char_com(unsigned char ch)
 115          {
 116   1        SBUF = ch;
C51 COMPILER V9.56.0.0   X5045                                                             09/29/2020 20:14:09 PAGE 3   

 117   1        while(!TI);
 118   1        TI = 0;
 119   1      }
 120          
 121          /*中断初始化*/
 122          void UartInit()
 123          {
 124   1        EA = 1;  //总中断
 125   1        ES = 1;  //串行中断
 126   1      }
 127          
 128          /*计算机发送字符给单片机，再通过单片机发送给x5045*/
 129          void receive_char_com() interrupt 4
 130          {
 131   1        int i;
 132   1        char num, a;
 133   1        
 134   1        if(RI == 1)     //收到数据
 135   1        {
 136   2          num = SBUF;
 137   2          RI = 0;       //清除标志位
 138   2        }
 139   1        if(TI == 1)  //发送完毕
 140   1        {TI = 0;}
 141   1        WriteSet(num,0x13);
 142   1        a = ReadSet(0x13);
 143   1        send_char_com(a);
 144   1      
 145   1      }
*** WARNING C280 IN LINE 131 OF x5045.c: 'i': unreferenced local variable


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    254    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       2
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
